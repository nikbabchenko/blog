'use strict';

var services = require('../services');

/**
 * Тег urlto для шаблонизатора Swig.
 * Возвращает URL для указанного маршрута.
 * Использование: {% urlto route_name [arg1 arg2 ...] %}
 */

module.exports = {
	name: 'urlto',
	block: true,
	ends: false,

	parse: function (str, line, parser, types, stack, options) {
		parser.on(types.VAR, function (token) {
			this.out.push(token.match);
		});
		parser.on(types.STRING, function (token) {
			this.out.push(token.match);
		});
		parser.on(types.NUMBER, function (token) {
			this.out.push(token.match);
		});
		return true;
	},

	compile: function (compiler, args, content, parents, options, blockName) {
		return '_output += \'' + services.router.get(args.shift()).url(args) + '\';';
	},
};
