'use strict';

var utils = require('./utils');

/**
 * Менеджер сервисов.
 */

var services = module.exports = {
	// Объект сервисов.
	services: {},

	/**
	 * Возвращает сервис.
	 * @param name имя сервиса.
	 * @return mixed
	 */

	get: function (name) {
		return (this.services[name] || utils.noop).call();
	},

	/**
	 * Устанавливает сервис.
	 * @param name имя сервиса.
	 * @param $callback функция создающая сервис.
	 */

	set: function (name, callback) {
		this.services[name] = callback;

		// Создаем геттер.
		var services = this;
		this.__defineGetter__(name, function () {
			return services.get(name);
		});
	},

	/**
	 * Создает сервис-одиночку.
	 * @param name имя сервиса.
	 * @param $callback функция создающая объект-сервис.
	 */

	singleton: function (name, callback) {
		var instance;
		this.set(name, function () {
			return instance = instance || callback.call();
		});
	},

	/**
	 * Создает сервис-замыкание.
	 * @param name имя сервиса.
	 * @param $callback функция-сервис.
	 */

	closure: function (name, callback) {
		this.set(name, function () {
			return callback;
		});
	},
};
